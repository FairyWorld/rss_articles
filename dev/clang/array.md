# 数组

## 简介

数组是一组相同类型的值。数组通过变量名后加方括号表示，方括号里面是数组的成员数量。

```c
int scores[100];
```

上面示例声明了一个数组`scores`，里面包含100个成员。

注意，声明数组时，必须给出数组的大小。

数组的成员从`0`开始编号，因此最后一个成员的编号会比数组长度小`1`。数组名后面使用方括号指定编号，就可以引用该成员。也可以通过该方式，对该位置进行赋值。

```c
scores[0] = 13;
scores[99] = 42;
```

上面示例对数组`scores`的第一个位置和最后一个位置，进行了赋值。

注意，如果引用不存在的数组成员（即越界访问数组），并不会报错，所以必须非常小心。

```c
int scores[100];

scores[100] = 51;
```

上面示例中，数组`scores`只有100个成员，因此`scores[100]`这个位置是不存在的。但是，引用这个位置并不会报错，会正常运行，使得紧跟在`scores`后面的那块内存区域被赋值，而那实际上是其他变量的区域，因此不知不觉就更改了其他变量的值。这很容易引发错误，而且难以发现。

数组也可以在声明时，使用大括号，同时对每一个成员赋值。

```c
int a[5] = {22, 37, 3490, 18, 95};
```

如果大括号里面的值，少于数组的成员数量，那么未赋值的成员自动初始化为`0`。

```c
int a[5] = {22, 37, 3490};
// 等同于
int a[5] = {22, 37, 3490, 0, 0};
```

如果要将整个数组设置为零，最简单的写法就是下面这样。

```c
int a[100] = {0};
```

注意，大括号里面的值不能多于数组的长度，否则编译时会报错。

C 语言允许下面的写法，根据大括号里面的值的数量，自动确定数组的长度。

```c
int a[] = {22, 37, 3490};
// 等同于
int a[3] = {22, 37, 3490};
```

数组的成员可以放各种类型的值，比如下面示例放入一个自定义类型。

```c
struct fraction numbers[1000];

numbers[0].numerator = 22;
numbers[0].denominator = 7;
```

上面示例声明了一个有1000个成员的数组`numbers`，每个成员都是自定义类型`fraction`的实例。

数组名是一个指针，指向数组第一个成员（`array[0]`）的地址。

数组名支持加法运算，加上一个整数会自动指向相应成员的地址。比如，`array + 3`会指向`array[3]`的地址（即`&(array[3])`）。

声明数组时，就自动分配了地址，并且是不可改变的。下面的代码会报错。

```c
int ints[100];

ints = NULL; // 报错
ints++; // 报错
```

## 数组长度

C 语言的数组长度，需要单独计算。

```c
int x[12];  // 12 ints

int length = sizeof x / sizeof(int);

printf("%zu\n", sizeof x);     // 48 total bytes
printf("%zu\n", sizeof(int));  // 4 bytes per int

printf("%zu\n", sizeof x / sizeof(int));
```

## 多维数组

C 语言允许声明多个维度的数组，有多少个维度，就用多少个方括号，比如二维数组就使用两个方括号。

```c
int board[10][10];
```

上面示例声明了一个二维数组，第一个维度有10个成员，第二个维度也有10个成员，相当于第一个维度的每个成员下面都各自有10个成员，因此整个二维数组就有100个成员（10 x 10 = 100）。

三维数组就使用三个方括号声明。

```c
int c[4][5][6];
```

引用二维数组时，需要使用两个方括号，同时指定两个维度。

```c
board[0][0] = 13;
board[9][9] = 13;
```

跟一维数组一样，每个维度的第一个成员也是从`0`开始编号。

多维数组也可以使用大括号，一次性对所有成员赋值。

```c
int a[2][5] = {
  {0, 1, 2, 3, 4},
  {5, 6, 7, 8, 9}
};
```

上面示例中，`a`是一个二维数组，但是也可以把它看成两个成员的一维数组，每个成员又是一个包含5个成员的一维数组。

## 数组的地址

获取指向数组第一个成员的指针。

```c
int a[5] = {11, 22, 33, 44, 55};
int *p;

p = &a[0];

printf("%d\n", *p);  // Prints "11"
```

C 语言提供了便利写法，数组变量等同于指向第一个成员的指针。

```c
p = &a[0];
// 等同于
p = a;
```

如果函数的参数是一维数组，那么传参时只需要传入第一个成员的地址就可以了。下面的写法都是等价的。

```c
void times2(int *a, int len);
void times3(int a[], int len);
void times4(int a[5], int len);
```

如果函数参数的是多维数组，那么定义函数时，数组第一维的长度是可以不写的，但是其余维度的长度必须要写。下面两种写法等价。

```c
void print_2D_array(int a[2][3]);
void print_2D_array(int a[][3]);
```

这是因为 C 语言只要知道，第一维的每个成员是多少个字节就可以了。

## 数组指针的加减法

数组指针的加法和减法，等同于在数组成员之间前后移动。

```c
int a[5] = {11, 22, 33, 44, 55};

for (int i = 0; i < 5; i++) {
  printf("%d\n", *(a + i));
}
```

上面示例中，`*(a + i)`等同于`a[i]`。

如果有一个指针变量`p`指向数组的第一个成员，那么`p++`就相当于指向下一个成员，因为就可以用这种方法来遍历数组。

```c
int a[] = {11, 22, 33, 44, 55, 999};

int* p = a;

while (*p != 999) {
  printf("%d\n", *p);
  p++;
}
```

同样的，指针减去`1`，就会指向前一个成员。如果两个指针相减，就会得到它们之间有多少个成员，请看下面的例子，我们自己实现一个计算字符串长度的函数。

```c
#include <stdio.h>

int my_strlen(char *s) {
  char *p = s;

  while (*p != '\0')
    p++;

    return p - s;
}

int main(void) {
  printf("%d\n", my_strlen("Hello, world!"));  // Prints "13"
}
```

由于数组与指针是等效的，所以下面的等式总是成立的。

```c
a[b] == *(a + b)
```

所以，数组成员有两种访问方式，一种是使用方括号`a[i]`，另一种是使用指针`*(a + i)`。对于数组的第一个成员，`a[0]`等同于`*(a + 0)`（即`*a`）。

