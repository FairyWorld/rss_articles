# C 语言简介

## 历史

1971年，美国贝尔实验室的 Ken Thompson 与 Dennis Ritchie 一起开发了 Unix 操作系统。Unix 是用汇编语言写的，无法移植到其他计算机，他们决定使用高级语言重写。但是，当时的高级语言无法满足他们的要求，Thompson 先是在 BCPL 语言的基础上发明了 B 语言。1972年，Ritchie 和 Brian Kernighan 又在 B 语言的基础上重新设计了一种新语言，这种新语言取代了 B 语言，所以称为 C 语言。

C 语言主要是为了开发 UNIX 而设计的，后来广泛用于操作系统和系统软件的开发。1988年，美国国家标准协会（ANSI）正式将 C 语言标准化。直到几十年以后的今天，C 语言依然是最广泛使用、最流行的系统编程语言之一，Unix 和 Linux 系统现在还是使用 C 语言开发。

## C 语言的编程哲学

C 语言假设程序员知道自己在干嘛，所以语言层面的限制很少，你可以用它直接操作计算机底层，干什么都可以，后果也由自己负责。一个典型的例子就是，它假设程序员会自己管理内存，所以不提供内存自动清理功能，程序员必须手动管理内存。另外，C 语言也不提供类型检查、数组的负索引检查、指针位置的检查。这些特点使得 C 语言的 debug 并不容易。

语法上，C 语言是一门“简单的”语言，包含的语法特性并不太多，也几乎没有语法糖。如果两个语法可以完成几乎相同的事情，C 语言就只提供一种语法。C 语言的语法都是基础语法，不提供高级语法，比如高级数据结构都需要自己构造，也没有“类”（class）这种东西。

所有这些特点，使得 C 语言的运行速度很快，但是也容易出错。不过从另一个角度看，C 语言的编译器实现起来，难度相对较低。

C 语言的一些优点：

- 语法相对简单
- 可以控制计算机低级别的活动
- 可以在各种计算机平台上进行编译

## C 语言的版本

历史上，C 语言有过多个版本。

（1）K＆R C

`K&R C`指的是 C 语言的原始版本。它以发明者布莱恩·克尼根（Brian Kernighan）和丹尼斯·里奇（Dennis Ritchie）姓氏的首字母命名。1978年，Kernighan 与其他人合著了一本非常有名的书《C 编程语言》（C programming language），这本书被认为是原始 C 语言的语法标准。

（2）ANSI C（又称 C89 或 C 90）

1989年，美国国家标准协会（ANSI）通过了 C 语言标准。1990年，国际标准化组织（ISO）也通过了这个标准。

（3）C95

1995年，美国国家标准协会对 C 语言标准，进行了补充，加入多字节字符和宽字符的支持。

（4）C99

C 语言标准的第一次大型修订，增加了许多语言特性，比如双斜杠（`//`）的注释语法。这是目前最流行的 C 版本。

（5）C11

2011年通过的 C 语言修订版，增加了 Unicode 和多线程的支持

（6）C17

2017年对 C11 标准进行了修补，但是发布是在2018年。它只是解决了 C11 的一些缺陷，没有引入任何新功能。

（7）C2x

C 语言正在讨论之中的下一个版本，可能会在2021年通过，到时就会改称为 C21。

## 编译语言

C 语言是一种编译语言，源码都是文本文件，只有通过编译器（compiler）才能生成二进制的可执行文件。编译器处理代码的过程，就称为编译阶段，简称为“编译时”（compile time）。

目前，最常见的编译器是自由软件基金会推出的 Gcc 编译器，它可以免费使用。本书也使用这个编译器。

C 语言的源代码文件，通常以后缀名`.c`结尾。下面是一个简单的 C 程序`hello.c`。

```c
# include <stdio.h>

int main(void) {
  printf("Hello World\n");
  return 0;
}
```

上面示例中，第一行是预处理命令，即编译器在开始编译之前所要执行的操作。`#include <stdio.h>`代表预处理指令，这里表示加载标准库文件`stdio.h`。注意，预处理指令的尾部不需要分号表示语句结束。

第三行是主函数`main()`，所有 C 程序都是从`main()`开始运行，即自动调用`main()`，如果没有这个函数，程序就无法启动。这里的`int main(void)`表示函数`main()`返回值的类型是整数（`int`），调用函数时不需要参数（`void`表示无参数）。

第四行是`printf()`函数，用来将参数显示在屏幕上。注意，语句要用分号表示结束，这是因为一行语句可以拆分成多行，不用分号很难确定结束位置。相比之下，预处理指令都只能写成一行。

第五行是函数的返回值命令`return 0`，返回整数`0`表示运行成功。如果运行失败，一般约定返回非零值。

然后，将这个源文件编译成二进制可执行文件。

```bash
$ gcc hello.c
```

上面代码使用`gcc`编译器，将源文件`hello.c`编译成二进制代码。编译产物的默认文件名是`a.out`，执行该文件，会输出`Hello World`。

```bash
$ ./a.out
Hello World
```

Gcc 的`-o`参数可以指定编译产物的文件名。

```bash
$ gcc -o hello hello.c
```

上面代码的编译产物就是`hello`。

```bash
$ ./hello
Hello World
```

## 变量

变量指的是内存的一块特定的区域，可以保存各种类型的值。变量名就是用来引用这块区域的代号。由于保存的值可能发生变化，所以称为变量。如果保存的值不会发生变化，那就是常量。

变量名可以包括字母、数字和下划线，但是不能以数字开头。变量名区分大小写，`x`和`X`是两个不同的变量。

C 语言要求，声明变量时，需要在变量名之前提供变量的类型。

```c
int num;
num = 42;
```

上面代码中，第一行声明了一个变量`num`，变量名之前是它的类型`int`（整数）。第二行给这个变量赋值。

一次声明多个变量也是可以的，类型关键字后面使用逗号，分隔多个变量名。

```c
float x, y, z, X;
```

注意，由于 C 语言不会自动清除内存，如果只声明变量、不进行赋值的话，该变量的值就会是该内存区域原来留存的值。这一点务必需要小心。

## 赋值运算符

赋值运算符`=`用来为变量赋值。

```c
i = 6;
```

注意，赋值运算有返回值，等于等号右边的值。

```c
y = (x = 2 * x)
```

上面代码中，变量`x`先是将自己的值倍增，然后返回这个新的值，赋给变量`y`。
