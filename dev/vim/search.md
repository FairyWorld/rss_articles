# 查找和替换

## 行内查找

`f字符`在当前行查找指定字符的下一个出现位置，如果找到，就移动光标到这个位置。例如，`fa`会把光标定位到当前行下一个出现的`a`字符。

找到该字符以后，可以输入`;`分号重复该查找，找到当前行后面的该字符。

## 文件内查找

`/词`向后查找当前文件内，指定词的下一个出现位置。如果找到，按下回车键，就会移动到该位置。

`?词`向前查找当前文件内，指定词的上一个出现位置。如果找到，按下回车键，就会移动到该位置。

找到指定词后，`N`键可以继续向后查找下一个出现位置，`n`键则是向前查找上一个出现位置。

`/`和`?`前面可以添加量词，表示所要搜索的第几个词。比如，`2/baby`表示搜索`baby`这个词在当前光标后面的第二个出现位置。

如果直接输入`/`或`?`，并按下回车键，Vim 将自动添加上一次搜索的指定词。

指定词可以是一个单词，也可以是正则表达式。

`*`键在当前文件内，搜索当前光标所在单词的下一个出现位置。

`#`键在当前文件内，搜索当前光标所在单词的上一个出现位置。

## 全局查找和替换

`:s`命令用来查找和替换，代表`substitute`。

```vim
# 发现所有行的 foo，替换为 bar
:%s/foo/bar/g

# 发现当前行的所有 foo，替换为 bar
:s/foo/bar/g

# 替换所有的 foo 为 bar，每一次都会要求确认
:%s/foo/bar/gc

# 只有整个词 foo 时（即两边有词边界），才将它替换为 bar
# 每一次替换都会要求确认
:%s/\<foo\>/bar/gc

# 全局替换，大小写不敏感，每一次替换都会要求替换
:%s/foo/bar/gci

# 替换第5行到第12行的所有 foo 为 bar
:5,12s/foo/bar/g
```

全局的查找和替换执行下面的命令。

```
:%s/Line/line/g
```

上面命令几个部分的含义如下。

- `:`	冒号字符运行一个 ex 命令。
- `%`	指定要操作的行数。% 是一个快捷方式，表示从第一行到最后一行。另外，操作范围也 可以用 1,5 来代替（因为我们的文件只有5行文本），或者用 1,$ 来代替，意思是 “ 从第一行到文件的最后一行。” 如果省略了文本行的范围，那么操作只对当前行生效。
- `s`	指定操作。在这种情况下是，替换（查找与替代）。
- `/Line/line`	查找类型与替代文本。
- `g`	这是“全局”的意思，意味着对文本行中所有匹配的字符串执行查找和替换操作。如果省略 g，则 只替换每个文本行中第一个匹配的字符串。

上面命令的尾部添加`c`，可以确认每一次替换。

```
:%s/line/Line/gc
```

执行上面命令以后，发现一个匹配之后，Vim会显示如下提示。

```
replace with Line (y/n/a/q/l/^E/^Y)?
```

上面几个确认字符的含义如下。

- y	执行替换操作
- n	跳过这个匹配的实例
- a	对这个及随后所有匹配的字符串执行替换操作。
- q or esc	退出替换操作。
- l	执行这次替换并退出。l 是 “last” 的简写。
- Ctrl-e, Ctrl-y	分别是向下滚动和向上滚动。用于查看建议替换的上下文。

```vim
:g/match/y A
```

上面命令将所有包含“匹配”的行拉入（复制）到"a/@a寄存器中。