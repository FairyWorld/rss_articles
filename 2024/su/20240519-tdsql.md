# 认识分布式数据库 

## 一、分布式数据库是什么？

我们日常接触的都是“单机数据库”，就是数据库只运行在一台服务器上。

![](https://cdn.beekka.com/blogimg/asset/202405/bg2024052001.webp)

（图片说明：左侧的单个数据库服务器，支撑着整个应用。）

今天想跟大家谈谈“分布式数据库”，这是一个很重要的概念。几乎所有你知道的大型互联网服务，都运行在它之上。

![](https://cdn.beekka.com/blogimg/asset/202405/bg2024052101.webp)

在宏观层面，金融、电信、航空、物流、电商这些重要产业，都离不开分布式数据库。如果列举对于国民经济最重要的单项技术，它肯定是其中之一。

在个人层面，当你从初级开发者成长为架构师，需要为整个应用设计架构时，除非只用一台服务器，否则肯定多多少少会遇到分布式数据库的问题，数据在多台服务器之间如何拆分和保存。这是个人能力成长、升职晋升的台阶。

那么，什么是分布式数据库呢？

概念很简单，**如果一个数据库系统分布在多台服务器，它就是分布式的**（distributed）。

![](https://cdn.beekka.com/blogimg/asset/202405/bg2024052002.webp)

(图片说明：单个数据库分布在多台服务器上，共同支撑应用。)

## 二、分布式数据库的优点

分布式数据库是数据库发展的必然结果，因为它有很多优点。

当公司变大，数据越来越多时，数据库拆分是很自然的想法。

**（1）更安全**。数据库包含多个节点，不管是放在同一个机房，还是不同机房，都要比单机数据库安全得多。

**（2）高可用**。如果单个数据库节点故障下线，其他节点还可以照常工作，不会单点失败。

**（3）性能更好**。对于大数据、大计算量的任务，分布式数据库可以并行处理，大大缩短处理时间。

**（4）体验更好**。当数据库分布在多个机房，可以为用户分配就近的数据库节点，提供更好的访问速度。

## 三、分布式数据库的难点

虽然有上面这些优点，但是分布式数据库的使用并不普及，这是为什么？

主要原因是，**分布式数据库有两大问题，阻碍了它的普及：成本高和复杂性。**

分布式数据库属于“异地多活”，提供了额外的冗余性，来保障数据安全，成本高自不必多言。

它的复杂性主要体现在下面几点。

**（1）一致性问题**。如何保证不同节点的数据是一致的？如果节点的数据不一致怎么办？

**（2）通信问题**。怎样保证节点之间的通信可靠？如果通信延迟或失败怎么办？

**（3）分区问题**。如果拆分大型数据表，数据储存在不同的节点，那么拆分策略、发生变化时的数据迁移可能会非常复杂。

**（4）优化问题**。如果来自多个节点的数据需要组合，查询就必须优化以提高性能。

## 四、CAP 定理

事实上，有一条著名的 CAP 定理，说的就是分布式系统（包括分布式数据库）无法克服的设计难点。

![](https://cdn.beekka.com/blogimg/asset/202405/bg2024052003.webp)

分布式系统的三大目标——数据一致（Consistency）、高可用（Availability）、数据分区（Partition tolerance）——无法同时满足，最多只能做到两个。

在数据分区的前提下，要么为了（强）一致性，舍弃高可用；要么为了高可用，舍弃（强）一致性。

因此，任何分布式数据库都做不到完美，只能是三大目标的某种取舍和均衡。

## 五、分布式数据库的产品

市场上有很多分布式数据库产品，大部分既可以单机使用，也可以分布式使用。

举例来说，在开源项目中，比较著名的有关系型数据库 Postgres 和非关系型数据库 CockroachDB，它们都内置了分布式支持。

![](https://cdn.beekka.com/blogimg/asset/202405/bg2024052102.webp)

![](https://cdn.beekka.com/blogimg/asset/202405/bg2024052103.webp)

网上搜索一下，不难发现几十种分布式数据库，包括开源的和商业的，数量太多，这里就不一一列出了，大家可以自己去搜。

## 六、云服务商的产品

分布式数据库的产品虽多，但是对于大多数公司来说，不会自己去搭建，一是没有专门的数据库和运维人才，二是这样很麻烦，投入也很高。

现在，云服务商都提供基于云的分布式数据库，正常情况下，首选是购买这些服务，这样更简单，只要网页点击几下，就开通了，费用也相对较低，后期的维护和扩容都不用自己操心。

![](https://cdn.beekka.com/blogimg/asset/202405/bg2024052104.webp)

如果公司的客户主要在国内，一般都会选择国内云服务商，因为他们有国内节点，而且有中文的文档和客服，交流起来比较容易。

下面我以国产的 TDSQL 为例，向大家展示一下现实中的分布式数据库是什么样。

## 七、以 TDSQL 为例

[TDSQL](https://cloud.tencent.com/product/tddbms) 是腾讯云的产品，属于国内领先的分布式数据库。

![](https://cdn.beekka.com/blogimg/asset/202405/bg2024052105.webp)

选择它来演示，主要因为我是腾讯云的用户，相对了解他们的产品。而且，TDSQL 包括多种数据库，功能很强，有足够的代表性。

![](https://cdn.beekka.com/blogimg/asset/202405/bg2024052106.webp)

根据产品介绍（上图），TDSQL 包括关系型数据库、Serverless 数据库、向量数据库、图数据库、时序数据库等多种类型。

它完全按照金融级的标准打造，在金融行业私有云数据库里面，国内大行覆盖率第一，据说已经有50万客户，使用非常广泛。

还有一个原因是，它分成集群版和基础版。前者是多节点的，供企业在生产环境使用；后者是单节点的，费用较低，专门供个人使用，但是功能是一样的。所以，个人开发者如果想学习或者尝试分布式数据库，也可以用它。

## 八、TDSQL 的用法

云服务商的分布式数据库，用起来很简单，在网页上开通后就可以使用。

**第一步**，在 TDSQL 的[官网](https://cloud.tencent.com/product/tddbms)上，进入产品控制台。

![](https://cdn.beekka.com/blogimg/asset/202405/bg2024052108.webp)

**第二步**，在控制台页面，选择数据库服务器所在的地域（跟你的云服务器应该是同一个地域），以及数据库引擎，然后点击“新建”按钮。

![](https://cdn.beekka.com/blogimg/asset/202405/bg2024052110.webp)

目前 TDSQL 有三种引擎：MySQL、自研的 TDStore 和 PostgreSQL。<u>不管哪一种引擎，都具备一样的容灾能力和高可用，并且兼容 Oracle，现有的企业 Oracle 数据库可以无缝迁移。</u>

**第三步**，会跳出一个配置页面，让你选择数据库配置。不同的配置，价格不一样。

其中有一项，问你要不要开通“强同步”。

![](https://cdn.beekka.com/blogimg/asset/202405/bg2024052111.webp)

强同步指的是，主节点（master）要等到从节点（slave）操作成功后，才向发出请求的应用返回结果，这样可以确保主从节点数据完全一致。如果你的应用不要求强一致，更在意快速返回结果，这里可以选择“异步”。

**第四步**，配置完成后，会进入付款环节，然后数据库就开通了，马上就可以使用。

使用时，需要先连接数据库，分成内网连接和外网连接，这里可以[参考文档](https://cloud.tencent.com/document/product/557/10238)。需要注意，如果开通外网连接，数据库就暴露在公网上，任何人都可以请求，必须注意安全风险。

连接数据库以后，就可以执行 SQL 语句了，这跟普通数据库没有任何区别。

## 九、总结

云服务商的分布式数据库，对于用户是没有感知的，不需要知道后端的物理架构，跟单机数据库的体验完全一样。

大量的复杂性，都由数据库系统自动在后台处理了。就拿 TDSQL 来说，它自动完成下面的任务。

**（1）自动水平拆分**。系统会自动将数据均匀写入不同物理分片，查询时自动聚合返回。

**（2）强同步复制**，保证各节点数据强一致性。

**（3）事务一致性**。系统为每一笔事务提供全局唯一数字序列，保证在全分布式环境下的事务一致性。

**（4）不停机弹性扩展**。需要扩展数据库时，只要在控制台点击，即可自动完成，无需关心系统内的数据迁移和路由切换。

具备上面这些能力的同时，TDSQL 始终保证企业级的数据安全和超高性能。除了公有云部署，对于需要的企业，它还提供私有云的独立部署。

总之，如果公司有分布式数据库需求，可以优先考虑云服务。

（完）

## 附：活动消息

5月24日，腾讯云有一个技术开放日 TechDay 活动。

![](https://cdn.beekka.com/blogimg/asset/202405/bg2024052112.webp)

活动主题就是数据管理和云数据库。

![](https://cdn.beekka.com/blogimg/asset/202405/bg2024052113.webp)

对于云数据库的企业级应用，感兴趣的同学可以关注一下。

![](https://cdn.beekka.com/blogimg/asset/202405/bg2024052114.webp)

