# 应用如何发布上线：新手入门应用管理平台

## 一、引言

应用的发布上线，是互联网行业自古就有的工序。

写好代码只是软件开发的前一半，将它发布到服务器，可以正常访问，是剩下的另一半。

![](https://cdn.beekka.com/blogimg/asset/202409/bg2024090402.webp)

长期以来，大家比较重视写代码，对于应用的发布上线，没有同样的重视，但是实际上，它也非常复杂和困难。

当然，早期的发布确实比较简单，把源码或者编译产物，通过 FTP 发到服务器，就算上线了。

![](https://cdn.beekka.com/blogimg/asset/202409/bg2024090403.webp)

但是，时过境迁，事情早就全变了。

一方面，现在的企业级应用，是一个庞然大物，由多个部分组成，比如计算引擎、静态资源、数据库、队列等等，它们可能需要同时发布上线，在这期间，网站还不能停机。

![](https://cdn.beekka.com/blogimg/asset/202409/bg2024090404.webp)

另一方面，服务器也不再是一台了，你的发布目标是一个集群，甚至是跨机房的多集群，底层硬件也不尽一致。

![](https://cdn.beekka.com/blogimg/asset/202409/bg2024090405.webp)

正因为事情变得如此复杂，应用的发布上线，在大公司里面，已经从开发团队剥离了，由一个独立的团队或部门来负责，使用的是专门为此开发的一整套软件工具。

**这种专门用于应用发布和线上管理的软件系统，就被称为“应用管理平台”**，可以看成是一个服务器集群的抽象层和使用接口，代码通过它们，完成部署和线上管理。

本文是一篇简单的“应用管理平台”的工具梳理和介绍，希望对大家有用。

## 二、Docker：标准化软件容器

互联网软件的发布革命，是由 [Docker](https://www.docker.com/) 引发的，一切要从它的诞生讲起。

![](https://cdn.beekka.com/blogimg/asset/202409/bg2024090406.webp)

软件开发有一个令人头痛的问题，就是开发环境与运行环境不一致。在我的机器可以运行，在你的机器却运行不了。

为此，在软件发布之前，要进行服务器的系统配置和依赖项的安装，确保符合软件运行的要求。

一台一台服务器这样搞，是非常麻烦的。虽然有 Ansible 这样的自动配置工具，但它只是一个 Python 脚本，并不能保证底层系统一致，况且它的使用也不算简单。

2013年，Docker 诞生了，创造性地解决了这个问题。**它的原理就是一句话，软件的运行环境与源代码打包在一起，做成一个容器镜像（image）**。

![](https://cdn.beekka.com/blogimg/asset/202409/bg2024090408.webp)

容器镜像本身就是一个二进制文件，可以直接发布。然后，只要把这个二进制文件部署到服务器，就能保证软件的运行环境是一致的，是不是很简单？

具体来说，Docker 让软件在容器（container）中运行，而容器是一个跟底层硬件无关的虚拟环境。开发者定制好这个虚拟环境，交付给用户就可以了。

这样就避免了一台台配置服务器，只要服务器安装好 Docker，软件就肯定能够正常运行，而且环境跟开发时是一样的，非常省心。

更重要的是，**容器镜像是一个标准化文件，不管软件使用什么语言开发，最后做成容器，都是一个格式**。因此，就可以用一个工具去处理所有项目的发布，完全忽略开发语言的差异。

<u>正是因为 Docker 提供了标准化、一站式的软件运行流程，才为通用的“应用管理平台”铺平了道路。</u>

后文的各种应用管理平台，都建立在 Docker 之上。不管软件是以源代码发布，还是以容器镜像发布，最后都运行在 Docker 里面。这已经是现代软件发布的标准做法了。

##  三、Kubernetes：容器编排引擎

各种“应用管理平台”之中，名气最大的非 [Kubernetes](https://kubernetes.io/) 莫属，它是事实上的企业级软件发布管理的标准。

它是谷歌开发的一款开源软件，因为词首`K`和词尾`s`之间有8个字符，所以常常写成 K8s。

![](https://cdn.beekka.com/blogimg/asset/202409/bg2024090407.webp)

Kubernetes 解决了什么问题呢？

前面说过，企业级的大型应用通常包含不同功能的多个组件，早期的开发实践是把它们做在一起，作为一个巨大的单体应用（monolithic）上线。

Docker 出现后，大大简化了软件发布的流程和工作量。于是，开发者考虑把这些组件都拆分出来，每一个组件都是一个独立的服务，单独发布。

<u>这就是现在流行的“微服务架构”（microservices），软件拆分成多个微服务，每个微服务对应一个独立的容器，这些容器同时构成一个软件系统。</u>

![](https://cdn.beekka.com/blogimg/asset/202409/bg2024090409.webp)

这意味着，每次发布都涉及大量不同的容器，管理它们就成了一种挑战。Kubernetes 就是为了解决这个问题。

它的官方定义是“容器编排引擎”，可以简单理解成，**Kubernetes 就是管理大量 Docker 容器的一个平台软件**。

具体来说，它主要有以下功能。

**（1）统一的硬件接口**。开发者不必关注底层的硬件细节，不管底层服务器有什么差异，分布在哪些机房，都被抽象成统一的操作接口。

**（2）自动扩展**。它可以根据软件负载情况，快速完成水平扩展。

**（3）高可用**。当某个容器失败时，它会自动重启或替换掉该容器，保证流量流向可用的节点。如果软件发布出现问题，还能自动回滚。

**（4）其他功能**。它还具有服务发现、负载均衡、资源监控等大量相关功能，同时带有庞大的插件和扩展，以及活跃的社区。

## 四、Dokku 和 Coolify：轻量级管理平台

Kubernetes 虽然功能强大，但是非常复杂，有陡峭的学习曲线，需要有熟悉容器的团队，个人开发者不易使用。

它一般只用在大规模生产环境，如果用在部署单个容器的应用，未免太重了。

于是，就出现了很多轻量级的容器运行和应用管理平台，适合个人使用，以及单服务器的应用，其中比较著名的有 [Dokku](https://dokku.com/) 和 [Coolify](https://coolify.io/)。

![](https://cdn.beekka.com/blogimg/asset/202409/bg2024090410.webp)

![](https://cdn.beekka.com/blogimg/asset/202409/bg2024090412.webp)

轻量级平台追求快速上手和易于使用，只要写几条配置，应用就能发布上线，用起来很简单。它们可以绑定代码库，只要有新的提交，就会自动更新线上容器。

相应地，跟 Kubernetes 相比，它们的功能比较少，而且一般只用于单个服务器，不用于多服务器的软件系统。

所以，它们非常适合个人开发者使用，可以用来自己搭建云应用管理平台（替代 Heroku / Netlify / Vercel 等商业服务）。

## 五、云服务商的应用管理平台：以腾讯云容器服务 TKE 为例

上面介绍的应用管理平台，可以看成是两个极端：强而复杂的 Kubernetes，小而简单的轻量级平台。

那么，有没有两者之间的选择呢？既有强大的功能和多集群支持，又提供便利的操作，只需在 Web 界面上点击，不必处处使用命令行。

答案就是使用云服务商的容器服务。

大型云服务商一般都提供基于容器的应用管理系统，**底层是 Kubernetes，但是经过的精心定制和包装，搭配好了标准化硬件，大大简化了操作**，使得用户尽可能不需要关注 Kubernetes 本身，在网页上开通后就可以使用。

下面以我比较熟悉的[腾讯云容器服务 TKE](https://cloud.tencent.com/product/tke)（Tencent Kubernetes Engine）为例。

![](https://cdn.beekka.com/blogimg/asset/202409/bg2024090413.webp)

TKE 除了提供 Kubernetes 的原生节点，还有一些自己的特色。

**（1）面向国内用户**。它的界面、文档和客服，都是中文的，它还提供大量的国内机房供选择，以及配套的国内镜像仓库。

**（2）面向可用区**（zone）。应用发布时，用户面向的是可用区，而不是底层的服务器集群。这样的话，服务器变动就对用户无感，同时又方便共用集群资源。

**（3）声明式管理**。应用的编排采用声明式写法，管理云原生节点，使用门槛低。

 **（4）低成本**。相比自己架设整个平台，云服务商的容器服务，费用更低，稳定性更高，各种操作都有现成的界面，有助于开发者专注于容器应用的开发，无需关心集群的管理和维护。

## 六、案例：腾讯健康的底层架构

腾讯健康就架设在 TKE 之上，我们通过它，来看看怎么使用容器服务，架设大型服务。

下图就是腾讯健康的底层架构。

![](https://cdn.beekka.com/blogimg/asset/202409/bg2024090201.webp)

上图中，网关（gateway）是访问入口，下面同时部署了三个可用区：zone1，zone2 和 zone3。它们部署在不同的机房。

这三个可用区是一模一样的，每个区都部署一个系统实例。每个系统实例包含三个层层依赖的应用：app1 依赖于 app2，app2 依赖 app3。这三个应用本身，每一个都是应用集群（app pods）。

这样的架构有三个好处，可以保证高可用和负载均衡。

**（1）容灾部署**。如果一个可用区出现故障，可以切换到另一个可用区（比如 zone1 的 app2 出现故障，可以切换到 zone2 的 app2），保证可用。

**（2）路由控制**。可以为用户分配就近的可用区，提高访问速度。

**（3）灰度发布**。新功能可以先在单个可用区进行灰度验证，完成之后再全可用区发布，降低发布风险。

## 七、总结

经过上面的介绍，大家应该已经了解了基于 Docker 的应用管理系统。

它有很多优点，可以全流程自动化，加快开发和上线速度，并带有很多配套工具，方便日常的线上管理，非常推荐使用。

至于具体的选择，如果是单服务器的项目，并且你有服务器管理的经验，可以选择轻量级的应用管理系统。其他情况，都建议选择云服务商的容器服务，除非是有运维团队的大公司。

（完）
