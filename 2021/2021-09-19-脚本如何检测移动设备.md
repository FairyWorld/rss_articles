# JS 脚本如何检测移动设备

浏览器展示网页时，有时需要知道，用户设备是否为手机。

本文根据 StackOverflow 的[网友回答](https://stackoverflow.com/questions/11381673/detecting-a-mobile-browser)，整理出了 JavaScript 脚本侦测移动设备的常用方法。

## 一、navigator.userAgent

最简单的侦测方法，就是分析 HTTP 请求的`User-Agent`字段。它是一个用户设备信息的字符串，脚本可以从`navigator.userAgent`属性拿到这个字符串。

只要里面有`mobi`、`android`、`iphone`等关键字，就可以判定是移动设备。

```javascript
if (/Mobi|Android|iPhone/i.test(navigator.userAgent)) {
   // 当前设备是移动设备
}

// 另一种写法
if (
  navigator.userAgent.match(/Mobi/i) ||
  navigator.userAgent.match(/Android/i) ||
  navigator.userAgent.match(/iPhone/i)
) {
  // 当前设备是移动设备
}
```

这种方法虽然方便，但是缺点在于用户可以伪造`User-Agent`字段，所以不是很可靠。

此外，还有一个[`navigator.platform`属性](https://stackoverflow.com/questions/19877924/what-is-the-list-of-possible-values-for-navigator-platform-as-of-today)，返回用户所用的操作系统。但是这个属性已经废除了，只是浏览器继续支持。

```javascript
if (/Android|iPhone|iPad|iPod/i.test(navigator.platform)) {
  // 当前设备是移动设备
}
```

基于 Chromium 的浏览器，有一个`navigator.userAgentData`属性，将`User-Agent`信息转成一个对象。该对象的`mobile`属性，返回一个布尔值，表示用户是否使用移动设备。

```javascript
const isMobile = navigator.userAgentData.mobile; 
```

[Caniuse 网站](https://caniuse.com/mdn-api_navigator_useragentdata)可以查看`navigator.userAgentData`属性的浏览器支持情况。

## 二、window.screen，window.innerWidth

`window.screen`属性返回一个对象，表示用户设备的屏幕信息。该对象的`width`属性是屏幕宽度，可以用来判断是否为移动设备。

```javascript
if (screen.width < 500) {
  // 当前设备是移动设备 
}
```

`window.innerWidth`属性则是返回网页可见部分的宽度，也可以用来判断移动设备。

```javascript
const getBrowserWidth = function() {
  if (window.innerWidth < 768) {
    return "xs";
  } else if (window.innerWidth < 991) {
    return "sm";
  } else if (window.innerWidth < 1199) {
    return "md";
  } else {
    return "lg";
  }
};
```

这两个属性的缺点是，如果手机横屏使用，就不认为当前设备是移动设备。

## 三、window.orientation

`window.orientation`属性返回一个字符串，表示手机屏幕当前的方向（竖屏还是横屏）。

只有移动设备才有这个属性，桌面设备没有部署，都会返回`undefined`，所以可以用来判断是否为移动设备。

```javascript
if (typeof window.orientation !== 'undefined') {
  // 当前设备是移动设备 
}
```

注意，iPhone 的 Safari 浏览器不支持该属性。

## 四、touch 事件

手机有`touch`事件，非触摸屏的桌面设备就没有这个事件，可以用来判断是否为移动设备。

```javascript
function isMobile() { 
  return ('ontouchstart' in document.documentElement); 
}

// 另一种写法
function isMobile() {
  try {
    document.createEvent("TouchEvent"); return true;
  } catch(e) {
    return false; 
  }
}
```

但是，这种方法不能排除触摸屏的桌面电脑。

## 五、window.matchMedia()

CSS 通过 media query 可以为网页指定响应式样式。如果某个针对手机的 media query 生效了，就可以认为当前设备是移动设备。

`window.matchMedia()`方法接受一个 CSS 的 media query 语句，可以判断这个语句是否生效。

```javascript
let isMobile = window.matchMedia("only screen and (max-width: 760px)").matches;
```

上面示例中，`window.matchMedia()`返回一个对象，该对象的`matches`属性返回一个布尔值，表示对应的 CSS 的 media query 语句是否生效。

除了通过屏幕宽度判断，还可以通过指针设备的精确性判断。

```javascript
let isMobile = window.matchMedia("（pointer:coarse）").matches;
```

上面设备中，`pointer:coarse`表示当前设备的指针设备是不精确的。由于手机不支持鼠标，只支持触摸，所以符合这个条件。

有些设备支持多种指针设备，比如同时支持鼠标和触摸，`pointer:coarse`只用来判断主设备。此外，还有一个`any-pointer`命令判断所有指针设备。

```javascript
let isMobile = window.matchMedia("(any-pointer:coarse)").matches;
```

上面示例中，`any-pointer:coarse`只要任何一个指针设备支持触摸，就满足条件。

## 六、工具包

除了上面这些方法，也可以使用别人写好的工具包。这里推荐[react-device-detect](https://www.npmjs.com/package/react-device-detect)，它支持非常精细的设备侦测。

```javascript
import {isMobile} from 'react-device-detect';

if (isMobile) {
  // 当前设备是移动设备
}
```

（完）