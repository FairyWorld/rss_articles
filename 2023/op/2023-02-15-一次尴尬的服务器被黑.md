## 本周话题：一次尴尬的服务器被黑

本周一凌晨（2月13日），我的个人网站服务器被黑了。

由于入侵者没有触发报警机制，我就没察觉。一觉醒过来，看到好多网友的邮件，让我快去看看网站，访问任何一个网页，都会跳转到 xxx 的外部网址，令人极度尴尬。

![](https://cdn.beekka.com/blogimg/asset/202302/bg2023021505.webp)

我查了一下服务器，发现果然如此。事态很严重，**对方拿到了网页目录的写入权限**，将我的所有 HTML 网页都删除了原始内容，写入了他的跳转代码`window.onload="..."`。

但是，数据库没有遭到破坏，加上没有 SSH 的异常登录报警，因此我判断，对方没有拿到服务器的登录权限，只是利用了 Web 服务的漏洞。

我的第一感觉不是恐慌，也不是愤怒，而是无奈。担心已久的事情，终于发生了。

很多朋友知道，我的个人网站至少有10年没有修改过样式了。不是不想改，而是没法改，或者说改起来很麻烦。

![](https://cdn.beekka.com/blogimg/asset/202302/bg2023021506.webp)

原因是我的后台软件采用了早期著名博客软件 MovableType，它的历史比 WordPress 还要悠久。后者已经是老古董了，你就知道它有多老了。当然，这说明我也老了，当年选择它的时候，我还是学生。

MovableType 早就停止发展了，转让给了一个日本公司，所有用户都要缴费，才能提交 Bug 和收到代码补丁。我没缴费，所以我的个人网站的后台早就老化了。

软件老化本身不是大问题，只要还能正常运行，并且你也不需要新功能，那么就能平安无事地过下去。真正的问题是它的依赖都过时了。

它依赖的底层系统和组件，都严重过时。我试过把它迁移到新系统，结果各种报错，不得不一直运行在很老的系统上。

我一直知道老系统不安全，但是又不敢升级。担心的事情最终还是爆发了。

![](https://cdn.beekka.com/blogimg/asset/202302/bg2023021507.webp)

前两年，我已经被攻击过一次，当时心存侥幸，只做了一些服务器加固，还是没升级，直到现在。

这次被攻击，我就想如法炮制。由于系统有定期快照，被黑后只要回滚到最近一次快照就可以了。我又改了一些服务器设置，星期一中午就把网站恢复上线了，心想最好这次也能蒙混过关。

但是，对方大概一直在线盯着我，上线一小时之内，又被一模一样地黑了。

这时，我知道事情麻烦了，只能将网站再次下线。好在上次被攻击时，我做过一个临时公告页面，这次还能用，把域名指向它即可。

![](https://cdn.beekka.com/blogimg/asset/202302/bg2023021508.webp)

此后整整一天，我一筹莫展，做好了最坏打算，个人网站可能要下线比较长的时间。在此期间，通过临时页面发布内容。

到了星期二下午，我越想越憋气，最后还是不死心，一咬牙决定升级服务器，死马当作活马医。

我一口气把底层系统和依赖组件，都升级到了最近的版本，整整装了一个多小时。这次结果很神奇，网站没有发生奇怪的报错，居然能正常运行。惊喜之余，我就把网站恢复上线了，到目前为止都是正常的。

说实话，我不肯定漏洞已经被修复了。如果接下来，服务器再次被黑，我就没辙了，只能下线了，然后加快进行原本就打算在今年或明年实施的计划：彻底重写博客架构，改成静态网站（现在还是传统的动态网站，跟 WordPress 类似的架构）。

这次的教训有很多，如果大家也想做一个独立博客，我有两点建议。

**（1）不要自己管理服务器。** 服务器管理是一个非常繁琐的专门工种，即使你拥有这方面的专业知识，也不值得自己来做这些事。网络世界是一个黑暗森林，到处都有人向你打冷枪，防不胜防，解决方法就下一条。

**（2）使用专业的云服务商。** 现在大部分云服务器商，都有静态网站托管服务，把静态网页托管在它们那里，省时省心。如果你需要后端动态生成内容，那就使用云函数（叫做 FaaS），通过服务商提供的边缘计算、而不是你的主机自带的 CPU 算力。
