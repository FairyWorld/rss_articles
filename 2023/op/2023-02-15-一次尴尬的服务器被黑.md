## 一次尴尬的服务器被黑

本周一凌晨（2月13日），我的个人网站服务器被黑了。

由于没有触发报警机制，我也没察觉。一觉醒过来，看到好多网友的邮件，让我快去看看网站，访问任何一个网页，都会跳转到 xxx 的外部网址，令人极度尴尬。

我查了一下服务器，发现事态严重，对方拿到了网页目录的写入权限，将我的所有 HTML 网页都删除了原始内容，写入了他的跳转代码`window.onload="..."`。

但是，数据库是好的，加上没有异常登录报警，因此我判断，对方没有拿到服务器的登录权限，只是利用了网站的漏洞。

这件事尴尬的地方，就在于我一直知道这个问题。很多朋友了解，我个人网站的样式至少有10年没改变了，不是不想改，而是没法改，或者改起来很费事。

网站后台采用了早期著名博客软件 MovableType，它比 WordPress 的历史还要悠久。后者已经是老古董了，你就知道它有多老了。当然，这说明我也老了，当年用它的时候，我还在学校读书。

MovableType 早就停止发展，转给了一个日本公司，所有用户都要向该公司缴费，进行维护和修 Bug。所以，我的个人网站的后台早就老化了。如果软件正常运行，并且你也不需要新功能，那么老化本身并不是一个问题，真正的问题是它的依赖都过时了。

它依赖的底层系统和组件，都严重过时。我试过把它迁移到新系统，结果各种报错，不得不一直运行在很老的系统上。这里说出来，应该也没关系，我用的底层系统是 Debian，网页服务器是 Apache，版本都非常老。

这次的攻击，应该与老版本的 Apache 漏洞有关，虽然具体的攻击细节我不清楚。以前，我已经被攻击过一次了，当时心存侥幸，只做了一些服务器加固，一直不敢升级，直到现在。

回过头来，再继续说，这次被攻击的事情。由于有各种备份措施，所以数据安全应该没问题，我按照上次的做法，在星期一中午，把网站回滚到最近一次快照，改了一些 APache 的设置，恢复上线。结果，对方大概一直在盯着我，一小时之内，又被一模一样地黑了。

这次，我知道麻烦了，只能将网站再次下线。好在上次被攻击时，我做了一个临时网页，这次还能用，只要把域名指向它即可。

还有一个尴尬的因素是，最近我还在云南，陪着父母在休养，随身只有一台旅行笔记本，可以登录服务器，但不适合做开发，没办法对网站进行调试或者大量改动。

我一筹莫展了整整一天，都做好了最坏打算，个人网站下线一段时间，内容都发到临时网页上。

后来还是不死心，一咬牙决定升级服务器，死马当作活马医。我把 Debian 和 Apache 都升级到了最近的版本。这次谢天谢地，网站没有发生那些奇怪的错误，所以就恢复上线了，到目前为止都是正常的。

说实话，我不肯定漏洞已经被修复了。如果还被攻击成功的话，就只能下线了o，我会加快原本就打算实施的计划：博客架构彻底重写，改成静态网站（现在还是传统的动态网站，跟 WordPress 类似的架构）。

这件事的教训有很多，如果大家也想做一个独立博客，我有两点建议。

（1）不要自己管理服务器。服务器管理和安全，是一个专门工种，即使你拥有这方面的专业知识，也不值得自己来做这些事。网络世界是一个黑暗森林，到处都有人向你打冷枪，防不胜防，解决方法就下一条。

（2）使用专业的云服务商。现在大部分云服务器商，都有静态网站托管服务，把静态网页托管在它们那里，省时省心。如果你需要托管动态内容，那就使用它们的云函数功能，通过边缘计算来生成动态内容。
