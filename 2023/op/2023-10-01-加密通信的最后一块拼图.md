## 加密通信的最后一块拼图

esni 会加密域名。

两个缺点：

- 缓存密钥会过时
- 前提是必须使用 DNS over TLS 或 DNS over HTTPS。因为密钥是从 DNS 获取的，如果 DNS 不加密，sni 加密就毫无意义。而且，密钥必须经常发生变化。

例如，要获取 crypto.dance 的密钥，客户端将请求 _esni.crypto.dance 的 TXT 记录：

$ dig _esni.crypto.dance TXT +short
"/wGuNThxACQAHQAgXzyda0XSJRQWzDG7lk/r01r1ZQy+MdNxKg/mAqSnt0EAAhMBAQQAAAAAX67XsAAAAABftsCwAAA="

ECH 细节 https://blog.cloudflare.com/encrypted-client-hello/

建议：如果你要访问 Cloudflare 上面的网站，建议不要开启 DOH，担心会触发 ECH。