## 腾讯的功效工具 PAG

上周，我遇到一个腾讯的朋友。

他说，腾讯有一个很重要的技术产品，很多人不知道，值得你好好了解一下。

我就问是什么东西，他回答是[动效工具 PAG](https://pag.art/)。

我的第一反应是，一个做动画效果的工具软件，值得特别了解吗？但是看了一下，它果真不简单。

它的最大特点是跨平台，各种平台（手机、Web、小程序、Windows、Linux、Mac……）都能用，而且不用修改，同一套动效适用所有平台。事实上，PAG 这个名字（ Portable Animated Graphics），就是“跨平台动画图形”的意思。

为了做到真正的“跨平台”，腾讯的同学居然自己写了一个 C++ 图形渲染底层库。所以，**它跟其他动效工具都不一样，不依赖平台自带的图形渲染，本质上属于一套独立的图形渲染解决方案**。

正因为它自带图形渲染，不必考虑各个平台的适配，所以具备很多其他方案做不到的优点。

熟悉动画效果的同学，大概知道以前实现一套动效，是很麻烦的事情，交付成本很高。设计师先在 After Effects 里面做出效果，导出给程序员看，后者再去实现这个效果。一般来说，需要来回沟通修改多次，费时费力。

现在有了 PAG，就简单了。程序员只负责在当前应用里面，接入 PAG 的 SDK；设计师则是安装一个 After Effects 插件，就能直接导出 PAG 文件，放到应用里面，自己就能完成上线。理论上，双方完全可以不见面。

而且，PAG 动效文件是二进制的，相比另一个著名动效工具 Lottie 的 SVG 文件，体积更小，解析时间更短。很多复杂的动效，只有 2 KB 左右，并且由于是二进制文件，图片、音频、视频都能打包进去，作为一个文件发布。

PAG 还自带一个开发工具 PAG Viewer，可以替换和调整二进制包里面的图片和文字，进一步方便了动画的生成和调试。

这样一个好用的工具，在腾讯内部从2016年开始已经开发了近7年。目前在腾讯所有主要业务线800+产品上落地，QQ、微信、王者荣耀、QQ 音乐都在使用它。比如，微信视频直播间的各种礼物特效，就是用它生成的。

去年，腾讯开源了 PAG，所以我们现在都可以免费使用它。源码仓库就放在 [GitHub](https://github.com/tencent/libpag)，已经有3000多颗星了。

大家可以先看看[官网案例](https://pag.art/case.html)和素材库网站“[动池](https://animate.art/)”，了解一下它的强大功能。下一个项目的动态方案，真的可以考虑它。

---

APP里会动的加载动画UI，还是直播间里华丽的礼物，都需要经历动效上线的过程。

设计、制作、调试，跨平台的问题

音视频产品中的动效素材需求是源源不断的，例如贴纸花字，转场特效，照片和视频模板等，并且对它们的产量，上线速度，以及视觉效果都有比较高的要求。但在传统工作流中的交付成本却非常高，需要通过代码来手动还原设计师预设的动效内容。

为了降低或消除动画相关的研发成本，腾讯内部历时 5 年研发了一套 PAG 动画工作流的解决方案，能够一键将 AE 动画内容导出并应用到几乎所有的主流平台。

腾讯研发了一款动画开发“神器”

- 跨平台
- 功能强大
- 开发成本低：简单场景下，不需要程序员，设计师直接就能做出产品上线。
- 学习成本也是很低的

文件小：关键是整个动效文件体积非常小，仅 2 KB左右。复杂的动画可以做得很小。

打包出来是二进制文件，但是它有一个 PAG Viewer 的工具，可以修改里面图片和文字，还可以调试性能。

这样一个投入了无数心血、用在腾讯所有重要业务线的产品，已经开源了。2500+ 星

PAG：Portable Animated Graphics

GitHub：https://github.com/tencent/libpag

官网：https://pag.io/
https://pag.art/

- Lottie 矢量动画
- SVGA 位图东湖
 
PAG 诞生于2016年，最初的原因是为了解决更为复杂的视频编辑场景下动画渲染问题，同时又完美覆盖了UI动画和直播场景。

PAG 流程

- 由AE生成对应动画
- 通过AE插件，完成动画导出部分
- 预览图片素材
- 导出对应文件
- 运营配置后，端上渲染

PAG 优势

- 全AE特性支持：目前支持Lottie在移动端几乎所有的功能，并且额外在文本，遮罩，滤镜方面比Lottie支持更加全面。比如一些内置的特效。
- 支持图层编辑
- 与视频渲染无缝整合
- 支持服务端渲染
- 文件更小：PAG是二进制文件格式，采用了动态比特位编码技术，让相同动画导出的文件大小平均只有 Lottie 的一半左右(都经过zip压缩后对比)。
- 解码更快：PAG由于采用二进制格式，不存在JSON的字符串解析，解码耗时平均只有Lottie文件的7.6%，同时二进制文件格式也更容易做到单文件集成图片，音频，视频等任意资源，所以它的解码速度比Lottie快得很多。
- PAGViewer 面板可以定性的评估PAG素材的性能，
- 全平台支持：以支持到Android、iOS、web、mac OS、windows、Linux，涵盖到所有平台。

配套工具 PAG Viewer

PAG：显著提升了动画设计到上线的效率，解决了行业在动画制作这块的大量痛点问题。目前接入PAG的产品，比如QQ，微信，王者荣耀，QQ音乐等。

PAG 方案目前已经接入了腾讯系 600 余款应用，包括微信，王者荣耀，腾讯视频，QQ音乐等产品，稳定性经过了海量用户的持续验证。

微信视频号的直播就在采用 PAG 方案实现所有的礼物动效

五个应用场景

- 直播礼物
- UI 动画
- 贴纸花字
- 视频模板
- 游戏战报。

