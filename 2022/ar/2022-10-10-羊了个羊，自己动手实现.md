# 羊了个羊，如何自己实现

最近小游戏[《羊了个羊》](https://baike.baidu.com/item/%E7%BE%8A%E4%BA%86%E4%B8%AA%E7%BE%8A/61983244)非常火爆，引发了全民关注。

![](https://cdn.beekka.com/blogimg/asset/202210/bg2022101202.webp)

本文就来介绍，这个游戏是怎么实现的，自己写一个简单版本。

它的实现一点不难，主要游戏逻辑都在前端，用到的都是普通的网页开发技术。如此简单的实现，却取得了这样巨大的市场效果，真是堪称奇迹。

![](https://cdn.beekka.com/blogimg/asset/202210/bg2022101203.webp)

所有演示放在“码上掘金”平台 [code.juejin.cn](https://code.juejin.cn/)。它是一个网页编程环境，可以在网页上运行代码（[后端语言](https://www.jcode.pub/?languages#/7116418967081582623)也可以），进行演示和分享，很像国外的 Codepen。国内的这种工具好像只有它一家。

![](https://cdn.beekka.com/blogimg/asset/202210/bg2022101204.webp)

下面，对于不了解的读者，我简单说一下，《羊了个羊》是怎么回事。其实，它就是一个传统的“消消乐”游戏（下图），同种花色的方块连到一起，就可以消除。

![](https://cdn.beekka.com/blogimg/asset/202210/bg2022101205.webp)

它在形式上，借鉴了国外的《消麻将》小游戏（下图）。

![](https://cdn.beekka.com/blogimg/asset/202210/bg2022101206.webp)

不同之处在于，它有一个槽位栏，存放取下的卡片（下图）。只要槽位栏里面，连续三张卡片花色相同，就能消除。

![](https://cdn.beekka.com/blogimg/asset/202210/bg2022101207.webp)

基本规则就是这样，你把所有卡片都消除了，就过关了。

大家可以想一想，如果你来写这个游戏，会怎么写？其实蛮简单的，核心逻辑只要两步。

第一步，网页上划出一个区域，将所有卡片堆成四层。每一层的卡片位置和花色分布，都用随机数控制。

第二步，可移动的卡片只要被点击，就从卡片区移动到槽位栏。

![](https://cdn.beekka.com/blogimg/asset/202210/bg2022101208.webp)

下面，我们就来实现上面的这两步。

我原想自己写，但在 GitHub 搜了一下“羊了个羊”，返回了近两百个结果，什么样的代码都有。

![](https://cdn.beekka.com/blogimg/asset/202210/bg2022101209.webp)

他们实现得比我完善，效果更好，所以我选了一个仓库 [chenxch/xlegex](https://github.com/chenxch/xlegex)，就用他的代码演示。

他使用 vue3 + TypeScript，所有源码加起来不到1000行。核心逻辑就是上面的两点，下面介绍一些实现细节。

首先，卡片对象的 TypeScript 类型如下。

![](https://cdn.beekka.com/blogimg/asset/202210/bg2022101210.webp)

可以看到，`id`属性是每张卡片的编号，`type`属性是卡片的图案，相同图案的卡片可消除。`state`属性则是卡片的状态，记录了是否已经点击或已经消除。

其余的属性则是卡片的位置，决定了它是哪一层的哪一张。

> - zIndex：卡片在哪一层
> - index：该层的卡片编号
> - row：卡片所在的行
> - column：卡片的列
> - top：卡片距离左上角的垂直距离
> - left：卡片距离右上角的水平距离

熟悉 CSS 的同学，看到`zIndex`、`top`、`left`这些属性名，可能已经想到了，作者使用“绝对定位 + zIndex”实现卡片的定位。

下面就是卡片组件的 UI 代码。

![](https://cdn.beekka.com/blogimg/asset/202210/bg2022101211.webp)

上面代码中，红框部分就是核心的定位逻辑，一点都不复杂。

卡片堆叠时，有一个地方需要注意，就是上一层卡片的顶点落在下一层卡片的中心点，从而可以露出下面的图案。

![](https://cdn.beekka.com/blogimg/asset/202210/bg2022101212.webp)

上面示意图中，黑色方块代表下一层的卡片，以它的中心点为基点，上一层可以放四张卡片，以红框表示。

最后得到的卡片堆叠效果，就是下面这张图。

![](https://cdn.beekka.com/blogimg/asset/202210/bg2022101214.webp)

卡片覆盖上图片，UI 就基本完成了。

![](https://cdn.beekka.com/blogimg/asset/202210/bg2022101215.webp)

最后，为每张图片加上 click 事件处理函数，游戏的核心逻辑就差不多了。

详细的源码解读，可以看[作者自己的文章](https://juejin.cn/post/7147245442172977189)，并试玩 [Demo](https://chenxch.github.io/xlegex/)。

![](https://cdn.beekka.com/blogimg/asset/202210/bg2022101216.webp)

但是，这个实现还不是最简单的，

正在举办一个编码比赛，欢迎大家提交自己的前端作品（网页游戏、网页动画、UI 效果等等）。

游戏逻辑都在前端代码，自己实现是不难的。

GitHub 搜一下，好多人已经实现了。

原理：https://juejin.cn/post/7147245442172977189

仓库：https://github.com/chenxch/xlegex

它的实现还不是最简单，我想要一个单文件的脚本。

掘金上面已经有了。

码上掘金实现 https://juejin.cn/post/7143897892531486727

https://code.juejin.cn/pen/7143796732931866660

码上掘金 跟 codepen 很像。